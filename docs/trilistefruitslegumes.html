<!DOCTYPE html>
<html>
<head>
<title>Tri de fruits et l√©gumes selon leur poids</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
<script src="utils.js"></script>
</head>
<body>
<section class="section">
<h1 class="title">Tri de fruits et l√©gumes selon leur poids</h1>
    <div class="columns">
        <div class="column">
            <article class="message is-info">
                <div class="message-header"><p>La situation</p>
                </div>
                <div class="message-body">
                    Vous devez trier vos sacs de fruits et l√©gumes par ordre de poids croissant, du plus l√©ger au plus lourd.  
                </div>
            </article>
            <article class="message is-warning">
                <div class="message-header"><p>Comment faire ?</p>
                </div>
                <div class="message-body">
                    <div class="block">Vous avez √† votre disposition la liste des sacs et une balance.
                    </div>
                    <div class="card has-background-warning-light" id="outils">
                        <header class="card-header">
                            <p class="card-header-title">
                                <span class="content">Les sacs</span>
                            </p>
                        </header>
                        <div class="card-content">
                            <div class="content is-centered" id="tableau">
                            </div>
                        </div>
                    </div>
                    <div class="card has-background-warning-light" id="outils">
                        <header class="card-header">
                            <p class="card-header-title">
                                <span class="content" id="balance">La balance ‚öñÔ∏è </span>
                            </p>
                        </header>
                        <div class="card-content">
                            <table class="table is-justify-content-center is-flex has-background-warning-light"  id="comparaison">
                            </table>
                        </div>                        
                    </div>
                    <div class="block"> 
                    Cliquez sur un sac de la liste pour le poser sur la balance. 
                    Lorsque deux sacs sont sur la balance, vous pouvez savoir lequel est le plus lourd.
                    
                    Vous pouvez alors choisir si vous voulez permuter les places de ces sacs
                    dans la liste ou non.
                    </div>
                    <div class="block">
                    Ensuite, recommencez avec deux autres sacs... jusqu'√† ce que la liste soit tri√©e.
                    </div>
                </div>
            </article>
            
        </div>
        <div class="column">
            <article class="message is-success" id="entete-message">
                <div class="message-header"><p id="message">J'√©crirai ici vos essais</p>
                </div>
                <div class="message-body">
                    <div class="block"  id="clics">
                    </div>
                    <div class="block"  id="essais">
                    </div>
                </div>
            </article>
        </div>
    </div>
</section>

<script>

prix = [7,4,8,5,3,1,2,6];
legumes = ["üçì","üçå","üçè","üçÜ","üçä","üçç","üçã","üçÖ"];
ponderes= [];
for(var c in prix){
    ponderes.push([prix[c],legumes[c]]);
}

selection = [];

l = new List(ponderes,{},{"classes":["is-large"],"click":verifier});
l.draw(document.querySelector("#tableau"));
permutations = 0;
clics = 0;

btn_permuter = document.createElement("span");
btn_permuter.className = "tag is-clickable is-medium";
btn_paspermuter = btn_permuter.cloneNode();
btn_permuter.addEventListener("click",permuter);
btn_paspermuter.addEventListener("click",paspermuter);
btn_permuter.innerHTML = "Oui";
btn_paspermuter.innerHTML = "Non";

function vider_selection(){
    const n = selection.length;
    for(i=0;i < n; ++i){
        l.remove_class_item(selection[0],"is-success");
        selection.shift();
    }
    console.log("s√©lection vid√©e "+selection);
    afficher_balance();
}

function permuter(){
    const a = selection[0];
    const b = selection[1];
    console.log("permuter "+a+" "+b+" = "+(a+b));
    permutations++ ;
    
    
    var msg = document.createElement("div");
    msg.className = "block";
    msg.innerHTML = "Permuter cellules d'index "+a+" et "+b;
    document.querySelector("#essais").appendChild(msg);
    
    l.swap(a,b);
    l.draw();
    vider_selection();
    afficher_balance()
    verifier_resultat();
}

function paspermuter(){
    vider_selection();
    afficher_balance()
}

function afficher_balance(){
    var n = selection.length;

    var b = document.querySelector("#balance");
    b.innerHTML = "La balance ‚öñÔ∏è ";
    
    var c = document.querySelector("#comparaison");
    c.innerHTML = "";
    
    if(n >= 1){
        b.innerHTML = b.innerHTML + l.list[selection[0]][1];
    }
    if(n ==2){
        b.innerHTML = b.innerHTML + " "+l.list[selection[1]][1];
        
        var ligne1 = c.insertRow();
        var ligne2 = c.insertRow();
        
        // plus l√©ger
        var d1 = ligne1.insertCell();
        d1.innerHTML = "Le plus l√©ger";
        
        // plus lourd
        // plus l√©ger
        var d1 = ligne1.insertCell();
        d1.innerHTML = "Le plus lourd";
        
        
        // calcul du min et max
        var i;
        var j;
        if (l.list[selection[0]][0]<l.list[selection[1]][0]){
            i = selection[0];
            j = selection[1];
        }else{
            i = selection[1];
            j = selection[0];
        }
        
        var brasg = document.createElement("span");
        brasg.className = "tag is-large";
        brasg.innerHTML = l.list[i][1];
        var c = ligne2.insertCell();
        c.appendChild(brasg);
        
        var brasd = brasg.cloneNode();
        brasd.innerHTML = l.list[j][1];
        var c = ligne2.insertCell();
        c.appendChild(brasd);
        
        var t = ligne1.insertCell();
        t.colSpan="2";
        t.className = "has-text-centered";
        t.innerHTML="Permuter ?";
        
        c = ligne2.insertCell();
        c.appendChild(btn_permuter);
        c.className = "has-text-centered is-vcentered";
        c = ligne2.insertCell();
        c.appendChild(btn_paspermuter);
        c.className = "has-text-centered is-vcentered";
        
    }
    
}
function verifier(elt){
    console.log("v√©rifier "+selection+" "+elt.target.innerHTML);
    var i = elt.target.dataset.number;
    if(selection.includes(i)){
        console.log(i+"est dedans");
        elt.target.classList.remove("is-success");
        if(i == selection[0]){
            selection.shift();
        }else{
            selection.pop();
        }
    }else{
        clics++;
        console.log(i+"n'est pas dedans");
        elt.target.classList.add("is-success");
        if(selection.length == 2){
            l.remove_class_item(selection[0],"is-success");
            selection.shift();
        }
        selection.push(i);
    }   
    afficher_balance();
    
    console.log("v√©rification faite :"+selection);
    document.querySelector("#clics").innerHTML = clics+" d√©placements de sacs vers la balance";
    verifier_resultat();
}

function verifier_resultat(){
    if(liste_triee(l.list.map(x => x[0]))){
        document.getElementById("message").innerHTML = "BRAVO ! Vous avez r√©ussi en "+permutations+" permutations et "+clics+" d√©placements de sacs vers la balance !";
        document.getElementById("entete-message").classList.remove("is-success");
        document.getElementById("entete-message").classList.add("is-danger");
        
        //document.querySelector("#consigne").innerHTML = "Rechargez la page si vous voulez recommencer.";
    }else{
        document.getElementById("message").innerHTML = "√Ä vous de jouer";
        document.getElementById("entete-message").classList.add("is-success");
        document.getElementById("entete-message").classList.remove("is-danger");
    }
}
</script>
</body>
</html>
